# Based on https://github.com/jfoenixadmin/JFoenix/blob/master/circle.yml
machine:
  pre:
    # This manual setup of Java 8 is required, since the Java 8 version provided by CircleCI does not contain JavaFX.
    - sudo add-apt-repository ppa:webupd8team/java -y
    - sudo apt-get update
    - echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true | sudo /usr/bin/debconf-set-selections
    - sudo apt-get install oracle-java8-installer oracle-java8-set-default
  environment:
    JAVA_HOME: /usr/lib/jvm/java-8-oracle

dependencies:
  override:
    - cp apikeys.properties.sample apikeys.properties
    - sed -i "s/<DB_KEY>/$DB_KEY/g" apikeys.properties
    - sed -i "s/<DB_SECRET>/$DB_SECRET/g" apikeys.properties
    - sed -i "s/<GD_KEY>/$GD_KEY/g" apikeys.properties
    - sed -i "s/<GD_SECRET>/$GD_SECRET/g" apikeys.properties
    - mvn install
test:
  post:
    - cd cm-gui
    - mvn jfx:native
    - tar -zcvf target/jfx/app/* "$CIRCLE_ARTIFACTS/app.tgz"
    - tar -zcvf target/jfx/native/* "$CIRCLE_ARTIFACTS/native.tgz"
